#:kivy 2.1.0

<ModBusPopup>:
    title: "CONFIGURAÇÕES MODBUS"
    bold: True
    background_color: 0, 0, 0, 0
    size_hint: None, None
    height: 300
    width: 400      

    BoxLayout:
        orientation: 'vertical'
        padding: 15
        spacing: 10
        canvas.before:
            Color:
                rgba: 0.788, 0.780, 0.780, 1
            Rectangle:
                pos: self.pos
                size: self.size

        # ================= CAMPOS =================
        GridLayout:
            cols: 2
            rows: 2
            size_hint_y: None
            height: 110
            spacing: 10

            Label:
                text: "IP"
                bold: True
                color: 0, 0, 0, 1
                font_size: 18

            TextInput:
                id: txt_ip
                text: "127.0.0.1"
                font_size: 18
                color: 0, 0, 0, 1
                halign: 'center'
                valign: 'middle'
                background_normal: ''
                background_active: ''
                background_color: 0.788, 0.780, 0.780, 1

            Label:
                text: "Porta"
                bold: True
                color: 0, 0, 0, 1
                font_size: 18

            TextInput:
                id: txt_port
                text: "502"
                font_size: 18
                color: 0, 0, 0, 1
                halign: 'center'
                valign: 'middle'
                background_normal: ''
                background_active: ''
                background_color: 0.788, 0.780, 0.780, 1

        # ================= BOTÕES =================
        BoxLayout:
            orientation: 'horizontal'
            size_hint_y: None
            height: 60
            spacing: 20

            Widget:

            RoundedButton:
                text: "Conectar"
                size_hint: None, None
                size: self.texture_size[0] + 40, 45
                # on_release: root.conectar()

            RoundedButton:
                text: "Fechar"
                size_hint: None, None
                size: self.texture_size[0] + 40, 45
                on_release: root.dismiss()

            Widget:

<ScanPopup>:
    title: "Configuração ScanTime"
    size_hint_y: None
    size_hint_x: 0.3
    height: 250

    BoxLayout:
        id: layout
        orientation: 'vertical'
        GridLayout:
            cols: 2
            rows: 1
            Label:
                text: "ScanTime[ms]"
                font_size: 14
            TextInput:
                id: txt_st
                text: "127.0.0.1"
                font_size: 14
                halign: 'center'
                valign: 'middle'
        BoxLayout:
            orientation: 'horizontal'
            Button:
                text: "Configurar"
                size_hint_y: None
                height: 40
                on_release:
                    root.dismiss() #fecha a janela e volta pra raiz
            Button:
                text: "Fechar"
                size_hint_y: None
                height: 40
                on_release: 
                    root.dismiss() #fecha a janela e volta pra raiz

<ComandoPopup>:
    title: "COMANDOS DE PARTIDA DO MOTOR"
    size_hint: None, None
    width: 970
    height: 500
    background_color: 0, 0, 0, 0

    BoxLayout:
        orientation: 'vertical'
        size_hint: 1, 1

        BoxLayout:
            orientation: 'horizontal'
            size_hint: 1, 0.8
            canvas.before:
                Color:
                    rgba: 0.788, 0.780, 0.780, 1
                Rectangle:
                    pos: self.pos
                    size: self.size

            # =======================
            # COLUNA ESQUERDA - TIPOS
            # =======================
            BoxLayout:
                orientation: 'vertical'
                size_hint_x: 0.3
                padding: 15
                spacing: 15

                Label:
                    text: "SELECIONE TIPO\nDA PARTIDA"
                    bold: True
                    color: 0, 0, 0, 1
                    font_size: 18
                    halign: 'center'
                    valign: 'middle'
                    text_size: self.size
                BoxLayout:
                    orientation: 'vertical'
                    spacing: 12
                    size_hint_y: 0.8
                    RoundedButton:
                        text: "TESYS DIRETA"
                        bold: False
                        pos_hint: {"center_x": 0.5}
                        on_release: root.trocar_tela("tesysDireta")
                        size_hint_x: 1

                    RoundedButton:
                        text: "ATV31 INVERSOR"
                        bold: False
                        pos_hint: {"center_x": 0.5}
                        on_release: root.trocar_tela("atv31")
                        size_hint_x: 1

                    RoundedButton:
                        text: "ATS48 SOFT-START"
                        bold: False
                        pos_hint: {"center_x": 0.5}
                        on_release: root.trocar_tela("ats48")
                        size_hint_x: 1

            # =======================
            # COLUNA DIREITA - OPÇÕES
            # =======================
            BoxLayout:
                size_hint_x: 0.3
                padding: 10

                ScreenManager:
                    id: sm
                    #current: "vazia"    

                    TesysDiretaScreen:
                        name: "tesysDireta"

                    ATS48Screen:
                        name: "ats48"

                    ATV31Screen:
                        name: "atv31"

                    VaziaScreen:
                        name: "vazia"


            # ==================================
            # COLUNA 3 - RELIGAMENTO
            # ==================================
            BoxLayout:
                orientation: 'vertical'
                size_hint_x: 0.30
                padding: 15
                spacing: 10

                canvas.before:
                    Color:
                        rgba: 0.788, 0.780, 0.780, 1
                    Rectangle:
                        pos: self.pos
                        size: self.size

                Label:
                    text: "RELIGAMENTO"
                    color: 0, 0, 0, 1
                    halign: 'center'
                    valign: 'middle'
                    bold: True
                    font_size: 18

                # -------- MODO --------
                BoxLayout:
                    orientation: 'vertical'
                    spacing: 5
                    # size_hint_y: 0.3

                    Label:
                        text: "Modo:"
                        color: 0, 0, 0, 1
                        font_size: 18
                        bold: True

                    BoxLayout:
                        orientation: 'horizontal'
                        Label:
                            text: "Manual"
                            color: 0, 0, 0, 1
                        CheckBox:
                            group: "relig"
                            active: True
                    BoxLayout:
                        orientation: 'horizontal'
                        Label:
                            text: "Automático"
                            color: 0, 0, 0, 1
                        CheckBox:
                            group: "relig"

                #Widget:  # espaçador

                BoxLayout:
                    orientation: 'vertical'
                    spacing: 5
                    size_hint_y: 0.7

                    BoxLayout:
                        orientation: 'horizontal'
                        spacing: 5
                        # size_hint_x: 0.5

                        # -------- PRESSÃO --------
                        Label:
                            text: "Mínima (kgf/cm²)"
                            color: 0, 0, 0, 1
                            bold: True
                            font_size: 18

                        TextInput:
                            text: "0.0"
                            color: 0, 0, 0, 1
                            multiline: False
                            input_filter: 'float'

                    # Widget:  # espaçador

                    BoxLayout:
                        orientation: 'horizontal'
                        spacing: 5
                        # size_hint_y: 0.5
                            
                        Label:
                            text: "Máxima (kgf/cm²)"
                            color: 0, 0, 0, 1
                            bold: True
                            font_size: 18

                        TextInput:
                            text: "5.0"
                            color: 0, 0, 0, 1
                            multiline: False
                            input_filter: 'float'
     # ================= BOTÃO FECHAR =================
        # BoxLayout:
        #     size_hint: 1, 0.2
        #     canvas.before:
        #         Color:
        #             rgba: 0.788, 0.780, 0.780, 1
        #         Rectangle:
        #             pos: self.pos
        #             size: self.size

        #     Widget:

        #     RoundedButton:
        #         text: "FECHAR"
        #         size_hint: None, None
        #         size: self.texture_size[0] + 40, 40
        #         pos_hint: {"center_x": 0.5}
        #         on_release: root.dismiss()

        #     Widget:


        # ================= BOTÃO FECHAR (MANTIDO) =================
        BoxLayout:
            size_hint: 1,0.2
            # height: 60
            canvas.before:
                Color:
                    rgba: 0.788, 0.780, 0.780, 1
                Rectangle:
                    pos: self.pos
                    size: self.size

            Widget:

            RoundedButton:
                text: "Fechar"
                size_hint: None, None
                size: self.texture_size[0] + 40, 45
                pos_hint: {"center_x": 0.5}
                on_release: root.dismiss()

            Widget:

        
# SOFT-START SCREEN
<ATS48Screen@Screen>:     
    BoxLayout:
        orientation: 'vertical'
        spacing: 15
        padding: 20

        Label:
            text: "ATS48 - Soft Starter"
            size_hint:1, 0.2
            bold: True
            color: 0, 0, 0, 1
            halign: 'center'
            valign: 'middle'
            font_size: 18
        Label:
            text: "Digite os parâmetros de\naceleração e desaceleração:"
            size_hint:1, 0.1
            bold: False
            color: 0, 0, 0, 1
            halign: 'center'
            valign: 'middle'
            font_size: 18
        Label:
            text: "MIN:10s e MAX:60s"
            size_hint:1, 0.1
            bold: True
            color: 0, 0, 0, 1
            halign: 'center'
            valign: 'middle'
            font_size: 16

        GridLayout:
            cols: 2
            spacing: 10
            size_hint:1, 0.6

            Label:
                text: "ACC"
                color: 0, 0, 0, 1
            TextInput:
                text: "10"
                color: 0, 0, 0, 1
                multiline: False

            Label:
                text: "DCC"
                color: 0, 0, 0, 1
            TextInput:
                text: "10"
                color: 0, 0, 0, 1
                multiline: False

<VaziaScreen@Screen>:
    BoxLayout:
        orientation: 'vertical'
        spacing: 15
        padding: 20

        Label:
            text: "CONFIGURAÇÃO DO \nTIPO DE PARTIDA"
            color: 0, 0, 0, 1
            bold: True
            halign: 'center'
            valign: 'middle'
            font_size: 18
            text_size: self.size
        Label:
            text: "Nenhum tipo de \n  partida selecionado"
            color: 0, 0, 0, 1
            halign: 'center'
            valign: 'middle'
            text_size: self.size
            font_size: 16

<TesysDiretaScreen@Screen>:
    BoxLayout:
        Label:
            text: "TESYS Direta \nselecionada"
            color: 0, 0, 0, 1
            halign: 'center'
            valign: 'middle'
            font_size: 18

<ATV31Screen@Screen>:
    BoxLayout:
        orientation: 'vertical'
        spacing: 15
        padding: 20

        Label:
            text: "ATV31 - Inversor"
            color: 0, 0, 0, 1
            bold: True
            font_size: 18

        Label:
            text: "Velocidade (Hz)"
            color: 0, 0, 0, 1

        Slider:
            id: vel_slider
            min: 0
            max: 60
            value: 0

        Label:
            text: f"{int(vel_slider.value)} Hz"
            color: 0, 0, 0, 1


# <ComandoPopup>:
#     title: "COMANDOS DE PARTIDA DO MOTOR"
#     bold: True
#     background_color: 0, 0, 0, 0
#     size_hint: None, None
#     height: 400
#     width: 900      

#     BoxLayout:
#         id: layout_base
#         orientation: 'horizontal'
#         canvas.before:
#             Color:
#                 rgba: 0.788, 0.780, 0.780, 1
#             Rectangle:
#                 pos: self.pos
#                 size: self.size
#         BoxLayout:
#             id: tipo_partida
#             orientation: 'vertical'
#             Label:
#                 id: texto
#                 text: "SELECIONE O TIPO DE PARTIDA"
#                 color: 0, 0, 0, 1
#                 bold: False
#                 font_size: 18
#             BoxLayout:
#                 orientation: 'vertical'
#                 RoundedButton:
#                     text: "TSYS DIRETA"
#                     #VER A POSICAO DESSE BOTAO
#                     #on_press: root.selecionar_partida('TSYS DIRETA')
#                 RoundedButton:
#                     text: "ATV31 INVERSOR"
#                 RoundedButton:
#                     text: "ATS48 SOFT-START"
#         BoxLayout:
#             id: layoutPartida
#             orientation: 'vertical'
#             Label:
#                 id: configMotor
#                 text: "ATS48"
#                 color: 0, 0, 0, 1
#                 bold: True
#                 font_size: 18
#             GridLayout:
#                 cols: 2
#                 rows: 2
#                 Label:
#                     text: "ACC"
#                     font_size: 14
#                 TextInput:
#                     id: txt_ip
#                     text: "10s"
#                     font_size: 14
#                     halign: 'center'
#                     valign: 'middle'
#                 Label:
#                     text: "DCC"
#                     font_size: 14
#                 TextInput:
#                     id: txt_port
#                     text: "10s"
#                     font_size: 14
#                     halign: 'center'
#                     valign: 'middle'
        
#         BoxLayout:
#             orientation: 'vertical'
#             Label:
#                 id: religamento
#                 text: "RELIGAMENTO"
#                 color: 1, 1, 1, 1
#                 bold: False
#                 font_size: 18
#         RoundedButton:
#             text: "FECHAR"
#             on_release: 
#                 root.dismiss() #fecha a janela e volta pra raiz



<TemperaturaPopup>:
    title: "TEMPERATURAS DO MOTOR"
    bold: True
    background_color: 0, 0, 0, 0
    size_hint: None, None
    width: 400      
    height: 250

    BoxLayout:
        orientation: 'vertical'
        padding: 10
        spacing: 10

        canvas.before:
            Color:
                rgba: 0.788, 0.780, 0.780, 1
            Rectangle:
                pos: self.pos
                size: self.size

        Widget:   # espaçador superior

        # ================= TEMPERATURA CARCAÇA =================
        BoxLayout:
            orientation: 'horizontal'
            size_hint_y: None
            height: 40

            Label:
                text: "Carcaça"
                bold: True
                font_size: 18
                color: 0, 0, 0, 1
                size_hint_x: 0.5
                halign: 'right'
                valign: 'middle'
                text_size: self.size

            Widget:

            Label:
                id: temp_C
                text: "-.- °C"
                font_size: 18
                color: 0, 0, 0, 1
                size_hint_x: 0.5
                halign: 'left'
                valign: 'middle'
                text_size: self.size

        Widget:   # espaçador entre texto e botão

        # ================= BOTÃO FECHAR =================
        BoxLayout:
            size_hint_y: None
            height: 45

            Widget:

            RoundedButton:
                text: "FECHAR"
                size_hint: None, None
                size: self.texture_size[0] + 40, 40
                pos_hint: {"center_x": 0.5}
                on_release: root.dismiss()

            Widget:

        Widget:   # espaçador inferior


        #GridLayout:
        #    cols: 2
        #    rows: 4
        #   Label:
        #        text: "Enrolamento R Motor"
        #        font_size: 16
        #    Label:
        #        id: temp_R
        #        text: "-.- °C"
        #        font_size: 16
        #    Label:
        #        text: "Enrolamento S Motor"
        #        font_size: 16
        #     Label:
        #         id: temp_S
        #         text: "-.- °C"
        #         font_size: 16
        #     Label:
        #         text: "Enrolamento T Motor"
        #         font_size: 16
        #     Label:
        #         id: temp_T
        #         text: "-.- °C"
        #         font_size: 16
        #     Label:
        #         text: "Carcaça"
        #         font_size: 16
        #     Label:
        #         id: temp_C
        #         text: "-.- °C"
        #         font_size: 16
        

<MedidasPopup>:
    title: "MEDIDAS ELÉTRICAS"
    bold: True
    background_color: 0, 0, 0, 0
    size_hint: None, None
    width: 650
    height: 550

    BoxLayout:
        orientation: 'vertical'
        padding: 10
        spacing: 10

        canvas.before:
            Color:
                rgba: 0.788, 0.780, 0.780, 1
            Rectangle:
                pos: self.pos
                size: self.size

        # ================= GRID PRINCIPAL =================
        GridLayout:
            cols: 2
            rows: 2
            spacing: 3

            # ================= TENSÃO =================
            BoxLayout:
                orientation: 'vertical'
                spacing: 5

                Label:
                    text: "Tensão"
                    bold: True
                    color: 0, 0, 0, 1
                    font_size: 18
                    size_hint_y: None
                    height: 30
                    canvas.after:
                        Color:
                            rgba: 0, 0, 0, 0.6
                        Line:
                            points: self.x, self.y, self.right, self.y
                            width: 1.2

                GridLayout:
                    cols: 2
                    row_default_height: 30
                    row_force_default: True

                    Label:
                        text: "R–S"
                        color: 0, 0, 0, 1
                    LabelTHD:
                        id: thd_tensao_rn

                    Label:
                        text: "S–T"
                        color: 0, 0, 0, 1
                    LabelTHD:
                        id: thd_tensao_sn

                    Label:
                        text: "T–R"
                        color: 0, 0, 0, 1
                    LabelTHD:
                        id: thd_tensao_tn

            # ================= CORRENTE =================
            BoxLayout:
                orientation: 'vertical'
                spacing: 5

                Label:
                    text: "Corrente"
                    bold: True
                    color: 0, 0, 0, 1
                    font_size: 18
                    size_hint_y: None
                    height: 30
                    canvas.after:
                        Color:
                            rgba: 0, 0, 0, 0.6
                        Line:
                            points: self.x, self.y, self.right, self.y
                            width: 1.2

                GridLayout:
                    cols: 2
                    row_default_height: 30
                    row_force_default: True

                    Label:
                        text: "Fase R"
                        color: 0, 0, 0, 1
                    LabelValorCorrente:
                        id: corrente_r

                    Label:
                        text: "Fase S"
                        color: 0, 0, 0, 1
                    LabelValorCorrente:
                        id: corrente_s

                    Label:
                        text: "Fase T"
                        color: 0, 0, 0, 1
                    LabelValorCorrente:
                        id: corrente_t

                    Label:
                        text: "Neutro"
                        color: 0, 0, 0, 1
                    LabelValorCorrente:
                        id: corrente_n

                    Label:
                        text: "Média"
                        color: 0, 0, 0, 1
                    LabelValorCorrente:
                        id: corrente_media

            # ================= DEMANDA =================
            BoxLayout:
                orientation: 'vertical'
                spacing: 5

                Label:
                    text: "Demanda"
                    bold: True
                    color: 0, 0, 0, 1
                    font_size: 18
                    size_hint_y: None
                    height: 30
                    canvas.after:
                        Color:
                            rgba: 0, 0, 0, 0.6
                        Line:
                            points: self.x, self.y, self.right, self.y
                            width: 1.2

                GridLayout:
                    cols: 2
                    row_default_height: 30
                    row_force_default: True

                    Label:
                        text: "Anterior"
                        color: 0, 0, 0, 1
                    LabelValorDemanda:
                        id: demanda_anterior

                    Label:
                        text: "Atual"
                        color: 0, 0, 0, 1
                    LabelValorDemanda:
                        id: demanda_atual

                    Label:
                        text: "Média"
                        color: 0, 0, 0, 1
                    LabelValorDemanda:
                        id: demanda_media

                    Label:
                        text: "Prevista"
                        color: 0, 0, 0, 1
                    LabelValorDemanda:
                        id: demanda_prevista

            # ================= POTÊNCIA =================
            BoxLayout:
                orientation: 'vertical'
                spacing: 5

                Label:
                    text: "Potência"
                    bold: True
                    color: 0, 0, 0, 1
                    font_size: 18
                    size_hint_y: None
                    height: 30
                    canvas.after:
                        Color:
                            rgba: 0, 0, 0, 0.6
                        Line:
                            points: self.x, self.y, self.right, self.y
                            width: 1.2

                GridLayout:
                    cols: 2
                    spacing: 10

                    # -------- ATIVA --------
                    BoxLayout:
                        orientation: 'vertical'
                        spacing: 5

                        Label:
                            text: "Ativa"
                            bold: True
                            color: 0, 0, 0, 1
                            size_hint_y: None
                            height: 25
                            canvas.after:
                                Color:
                                    rgba: 0, 0, 0, 0.6
                                Line:
                                    points: self.x, self.y, self.right, self.y
                                    width: 1.2

                        GridLayout:
                            cols: 2
                            row_default_height: 30
                            row_force_default: True

                            Label:
                                text: "R"
                                color: 0, 0, 0, 1
                            LabelValorPotAtiva:
                                id: ativa_r

                            Label:
                                text: "S"
                                color: 0, 0, 0, 1
                            LabelValorPotAtiva:
                                id: ativa_s

                            Label:
                                text: "T"
                                color: 0, 0, 0, 1
                            LabelValorPotAtiva:
                                id: ativa_t

                    # -------- OUTRAS --------
                    BoxLayout:
                        orientation: 'vertical'
                        spacing: 5

                        Label:
                            text: "Reativa"
                            bold: True
                            color: 0, 0, 0, 1
                        Label:
                            id: reativa_total
                            text: "-.- var"
                            color: 0, 0, 0, 1

                        Label:
                            text: "Aparente"
                            bold: True
                            color: 0, 0, 0, 1
                        Label:
                            id: aparente_total
                            text: "-.- VA"
                            color: 0, 0, 0, 1

                        Label:
                            text: "FP"
                            bold: True
                            color: 0, 0, 0, 1
                        Label:
                            id: fator_potencia
                            text: "-.-"
                            color: 0, 0, 0, 1

        # ================= BOTÃO FECHAR (MANTIDO) =================
        BoxLayout:
            size_hint_y: None
            height: 60

            Widget:

            RoundedButton:
                text: "Fechar"
                size_hint: None, None
                size: self.texture_size[0] + 40, 45
                pos_hint: {"center_x": 0.5}
                on_release: root.dismiss()

            Widget:


<GraficoPopup>:
    title: "Janela de Gráficos"   #tem que ser do tamanho da tela
    size_hint_y: 1
    size_hint_x: 1 

<BancoDadosPopup>:
    title: "Configuração Banco de Dados"
    size_hint_y: None
    size_hint_x: 0.3
    height: 150